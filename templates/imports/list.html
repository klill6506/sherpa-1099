{% extends "base.html" %}

{% block title %}Import Data - Sherpa 1099{% endblock %}

{% block content %}
<div class="mb-6">
    <h1 class="text-2xl font-bold text-sherpa-text">Import Data</h1>
    <p class="text-sherpa-muted">Upload Excel workbooks to import 1099 data</p>
</div>

<!-- Prominent Upload Section -->
<div class="rounded-2xl bg-sherpa-card ring-1 ring-sherpa-border shadow-sherpa p-8 mb-8">
    <div class="flex flex-col md:flex-row items-center gap-6">
        <div class="flex-shrink-0">
            <div class="w-20 h-20 rounded-2xl bg-sherpa-teal/15 flex items-center justify-center">
                <svg class="w-10 h-10 text-sherpa-teal" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12"/>
                </svg>
            </div>
        </div>
        <div class="flex-1 text-center md:text-left">
            <h2 class="text-lg font-semibold text-sherpa-text mb-1">Upload New Workbook</h2>
            <p class="text-sherpa-muted text-sm mb-4">Import 1099-NEC, 1099-MISC, and other forms from Excel files</p>
            <a href="/imports/upload"
               class="inline-flex items-center gap-2 px-8 py-3 bg-sherpa-teal text-sherpa-bg rounded-xl font-bold hover:bg-sherpa-teal/90 transition-colors text-lg shadow-lg">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Upload File
            </a>
        </div>
        <div class="flex-shrink-0">
            <a href="/download-template"
               class="inline-flex items-center gap-2 px-4 py-2 bg-sherpa-panel text-sherpa-muted rounded-xl hover:text-sherpa-text hover:bg-sherpa-card transition-colors border border-sherpa-border text-sm">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"/>
                </svg>
                Download Template
            </a>
        </div>
    </div>
</div>

<!-- Prior Uploads (Compact) -->
{% if batches %}
<div class="rounded-2xl bg-sherpa-card ring-1 ring-sherpa-border shadow-sherpa overflow-hidden">
    <div class="px-4 py-3 border-b border-sherpa-border flex items-center justify-between">
        <h3 class="text-sm font-medium text-sherpa-muted">Recent Uploads</h3>
        <span class="text-xs text-sherpa-subtle">{{ batches|length }} file{% if batches|length != 1 %}s{% endif %}</span>
    </div>
    <div class="divide-y divide-sherpa-border max-h-64 overflow-y-auto">
        {% for batch in batches[:10] %}
        <div class="px-4 py-2 flex items-center justify-between hover:bg-sherpa-panel/50 transition-colors">
            <div class="flex items-center gap-3 min-w-0">
                <div class="w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0
                    {% if batch.status == 'promoted' %}bg-sherpa-teal/15 text-sherpa-teal
                    {% elif batch.status == 'validated' %}bg-sherpa-blue/15 text-sherpa-blue
                    {% elif batch.status == 'failed' %}bg-sherpa-red/15 text-sherpa-red
                    {% else %}bg-sherpa-panel text-sherpa-subtle{% endif %}">
                    {% if batch.status == 'promoted' %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                    </svg>
                    {% elif batch.status == 'failed' %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                    {% else %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    {% endif %}
                </div>
                <div class="min-w-0">
                    <p class="text-sm font-medium text-sherpa-text truncate">{{ batch.filename }}</p>
                    <p class="text-xs text-sherpa-subtle">
                        {{ batch.uploaded_at[:10] if batch.uploaded_at else '-' }}
                        <span class="mx-1">·</span>
                        {{ batch.total_rows }} row{% if batch.total_rows != 1 %}s{% endif %}
                        {% if batch.valid_rows > 0 %}
                        <span class="mx-1">·</span>
                        <span class="text-sherpa-teal">{{ batch.valid_rows }} valid</span>
                        {% endif %}
                        {% if batch.error_rows > 0 %}
                        <span class="mx-1">·</span>
                        <span class="text-sherpa-red">{{ batch.error_rows }} error{% if batch.error_rows != 1 %}s{% endif %}</span>
                        {% endif %}
                    </p>
                </div>
            </div>
            <div class="flex items-center gap-2 flex-shrink-0">
                <span class="px-2 py-0.5 text-xs rounded-full
                    {% if batch.status == 'promoted' %}bg-sherpa-teal/15 text-sherpa-teal
                    {% elif batch.status == 'validated' %}bg-sherpa-blue/15 text-sherpa-blue
                    {% elif batch.status == 'failed' %}bg-sherpa-red/15 text-sherpa-red
                    {% else %}bg-sherpa-panel text-sherpa-subtle{% endif %}">
                    {{ batch.status }}
                </span>
                <a href="/imports/{{ batch.id }}" class="text-sherpa-blue hover:text-sherpa-blue/80 text-xs font-medium">
                    {% if batch.status == 'promoted' %}View{% else %}Review{% endif %}
                </a>
            </div>
        </div>
        {% endfor %}
    </div>
    {% if batches|length > 10 %}
    <div class="px-4 py-2 border-t border-sherpa-border text-center">
        <span class="text-xs text-sherpa-subtle">Showing 10 of {{ batches|length }} uploads</span>
    </div>
    {% endif %}
</div>
{% else %}
<div class="rounded-2xl bg-sherpa-card ring-1 ring-sherpa-border shadow-sherpa p-6 text-center">
    <p class="text-sm text-sherpa-subtle">No previous uploads</p>
</div>
{% endif %}
{% endblock %}
