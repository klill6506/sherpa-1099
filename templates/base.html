<!DOCTYPE html>
<html lang="en" x-data="{ darkMode: localStorage.getItem('darkMode') === 'true' }" :class="{ 'dark': darkMode }">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}Sherpa 1099{% endblock %}</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        // Sherpa Theme Colors
                        sherpa: {
                            // Semantic Colors (same in both modes)
                            blue: "#3b82f6",
                            green: "#10b981",
                            amber: "#f59e0b",
                            red: "#ef4444",
                            teal: "#2ED3C6",

                            // Light mode colors
                            "light-bg": "#e8f4fc",
                            "light-card": "rgba(255, 255, 255, 0.85)",
                            "light-panel": "rgba(255, 255, 255, 0.6)",
                            "light-border": "rgba(255, 255, 255, 0.5)",
                            "light-text": "#1e3a5f",
                            "light-muted": "#4a6b8a",
                            "light-subtle": "#7a9ab8",

                            // Dark mode colors (charcoal)
                            "dark-bg": "#1a1f2e",
                            "dark-card": "#252b3d",
                            "dark-panel": "#1f2536",
                            "dark-border": "#353d52",
                            "dark-text": "#E6EDF7",
                            "dark-muted": "#B7C3D6",
                            "dark-subtle": "#8892a8",
                        }
                    },
                    boxShadow: {
                        'glass': '0 8px 32px rgba(31, 38, 135, 0.1)',
                        'glass-sm': '0 4px 16px rgba(31, 38, 135, 0.08)',
                        'sherpa': '0 1px 0 rgba(255,255,255,0.04), 0 10px 30px rgba(0,0,0,0.35)',
                    },
                }
            }
        }
    </script>

    <!-- Alpine.js for interactivity -->
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

    <style>
        [x-cloak] { display: none !important; }

        /* ========== LIGHT MODE (Default) ========== */
        html:not(.dark) body {
            background: linear-gradient(180deg, #b8daf0 0%, #c9e4f7 20%, #daeefb 50%, #e8f4fc 80%, #f0f9ff 100%);
            background-attachment: fixed;
        }

        /* Distant mountains - back layer (lighter blue, atmospheric) */
        html:not(.dark) body::before {
            content: '';
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 45vh;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320' preserveAspectRatio='xMidYMax slice'%3E%3Cdefs%3E%3ClinearGradient id='distant' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23a8cce3'/%3E%3Cstop offset='100%25' stop-color='%23c4dff2'/%3E%3C/linearGradient%3E%3ClinearGradient id='mid' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%237db5d6'/%3E%3Cstop offset='100%25' stop-color='%23a5d0ea'/%3E%3C/linearGradient%3E%3ClinearGradient id='front' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%235a9bc4'/%3E%3Cstop offset='100%25' stop-color='%2388c0de'/%3E%3C/linearGradient%3E%3ClinearGradient id='snow1' x1='0%25' y1='0%25' x2='0%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%23ffffff'/%3E%3Cstop offset='100%25' stop-color='%23e8f4fc'/%3E%3C/linearGradient%3E%3C/defs%3E%3C!-- Distant range --silhouette --%3E%3Cpath fill='url(%23distant)' d='M0,320 L0,180 Q60,150 120,165 Q180,130 240,145 Q320,90 400,120 Q480,80 560,100 Q640,60 720,85 Q800,50 880,75 Q960,40 1040,70 Q1120,55 1200,80 Q1280,65 1360,95 Q1400,85 1440,100 L1440,320 Z'/%3E%3C!-- Distant snow caps --%3E%3Cpath fill='white' opacity='0.7' d='M720,85 Q700,95 690,110 Q720,100 750,110 Q740,95 720,85 Z M880,75 Q858,88 848,105 Q880,92 912,105 Q902,88 880,75 Z M1040,70 Q1015,85 1005,102 Q1040,88 1075,102 Q1065,85 1040,70 Z'/%3E%3C!-- Middle range --%3E%3Cpath fill='url(%23mid)' d='M0,320 L0,210 Q80,180 160,195 Q240,150 320,175 Q420,110 520,145 Q600,100 680,130 Q780,80 880,115 Q960,85 1040,110 Q1140,75 1240,105 Q1320,90 1400,115 L1440,105 L1440,320 Z'/%3E%3C!-- Middle snow caps --%3E%3Cpath fill='url(%23snow1)' d='M520,145 Q490,160 475,185 Q520,165 565,185 Q550,160 520,145 Z M680,130 Q650,148 638,170 Q680,152 722,170 Q710,148 680,130 Z M880,115 Q845,135 830,160 Q880,138 930,160 Q915,135 880,115 Z M1040,110 Q1008,130 995,155 Q1040,133 1085,155 Q1072,130 1040,110 Z M1240,105 Q1205,128 1190,155 Q1240,130 1290,155 Q1275,128 1240,105 Z'/%3E%3C!-- Front range --%3E%3Cpath fill='url(%23front)' d='M0,320 L0,250 Q100,220 200,240 Q320,180 440,215 Q540,160 640,195 Q760,140 880,180 Q980,150 1080,175 Q1180,145 1280,175 Q1360,160 1440,180 L1440,320 Z'/%3E%3C!-- Front snow caps --%3E%3Cpath fill='white' d='M440,215 Q405,235 388,262 Q440,238 492,262 Q475,235 440,215 Z M640,195 Q600,220 582,250 Q640,222 698,250 Q680,220 640,195 Z M880,180 Q835,208 815,242 Q880,210 945,242 Q925,208 880,180 Z M1080,175 Q1040,202 1022,235 Q1080,205 1138,235 Q1120,202 1080,175 Z M1280,175 Q1242,200 1225,232 Q1280,203 1335,232 Q1318,200 1280,175 Z'/%3E%3C!-- Treeline hint at base --%3E%3Cpath fill='%234a8ab5' opacity='0.6' d='M0,320 L0,290 Q30,280 60,285 Q90,275 120,282 Q150,272 180,280 Q210,270 240,278 Q270,268 300,276 Q330,266 360,275 Q390,265 420,274 Q450,264 480,273 Q510,263 540,272 Q570,262 600,271 Q630,261 660,270 Q690,260 720,269 Q750,259 780,268 Q810,258 840,267 Q870,257 900,266 Q930,256 960,265 Q990,255 1020,264 Q1050,254 1080,263 Q1110,253 1140,262 Q1170,252 1200,261 Q1230,251 1260,260 Q1290,250 1320,259 Q1350,249 1380,258 Q1410,248 1440,257 L1440,320 Z'/%3E%3C/svg%3E") no-repeat bottom center;
            background-size: cover;
            pointer-events: none;
            z-index: 0;
        }

        /* No second layer needed - all in one SVG */
        html:not(.dark) body::after {
            display: none;
        }

        /* Frosted glass - Light */
        html:not(.dark) .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
        }

        html:not(.dark) .glass-light {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255, 255, 255, 0.4);
        }

        /* Light scrollbar */
        html:not(.dark) ::-webkit-scrollbar { width: 8px; height: 8px; }
        html:not(.dark) ::-webkit-scrollbar-track { background: rgba(255,255,255,0.3); }
        html:not(.dark) ::-webkit-scrollbar-thumb { background: rgba(100,150,200,0.3); border-radius: 4px; }
        html:not(.dark) ::-webkit-scrollbar-thumb:hover { background: rgba(100,150,200,0.5); }

        /* ========== DARK MODE (Charcoal) ========== */
        html.dark body {
            background: #1a1f2e;
        }

        html.dark body::before,
        html.dark body::after {
            display: none;
        }

        /* Cards - Dark (Charcoal) */
        html.dark .glass {
            background: #252b3d;
            backdrop-filter: none;
            border: 1px solid #353d52;
        }

        html.dark .glass-light {
            background: #1f2536;
            backdrop-filter: none;
            border: 1px solid #353d52;
        }

        /* Dark scrollbar */
        html.dark ::-webkit-scrollbar { width: 8px; height: 8px; }
        html.dark ::-webkit-scrollbar-track { background: #1a1f2e; }
        html.dark ::-webkit-scrollbar-thumb { background: #353d52; border-radius: 4px; }
        html.dark ::-webkit-scrollbar-thumb:hover { background: #454f68; }

        /* ========== Theme-aware utility classes ========== */
        .theme-text { color: #1e3a5f; }
        .dark .theme-text { color: #E6EDF7; }

        .theme-muted { color: #4a6b8a; }
        .dark .theme-muted { color: #B7C3D6; }

        .theme-subtle { color: #7a9ab8; }
        .dark .theme-subtle { color: #7D8AA5; }

        .theme-bg { background-color: #e8f4fc; }
        .dark .theme-bg { background-color: #1a1f2e; }

        .theme-card { background-color: rgba(255, 255, 255, 0.85); }
        .dark .theme-card { background-color: #252b3d; }

        .theme-border { border-color: rgba(255, 255, 255, 0.5); }
        .dark .theme-border { border-color: #353d52; }

        /* Hover states */
        .theme-hover:hover { background-color: rgba(255, 255, 255, 0.5); }
        .dark .theme-hover:hover { background-color: #2d3548; }
    </style>
    {% block extra_head %}{% endblock %}
</head>
<body class="theme-text min-h-screen antialiased flex flex-col relative">
    <!-- Navigation -->
    <nav class="sticky top-0 z-50 glass shadow-glass-sm">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="flex items-center gap-3">
                        <!-- Yeti Mascot - Friendly rounded style with sunglasses -->
                        <svg class="w-12 h-12" viewBox="0 0 64 64" fill="none">
                            <!-- Body -->
                            <ellipse cx="32" cy="52" rx="18" ry="10" fill="#E8F4FC"/>
                            <!-- Arms -->
                            <ellipse cx="12" cy="44" rx="6" ry="10" fill="#E8F4FC"/>
                            <ellipse cx="52" cy="44" rx="6" ry="10" fill="#E8F4FC"/>
                            <!-- Head - large round -->
                            <circle cx="32" cy="28" r="22" fill="#E8F4FC"/>
                            <!-- Ears -->
                            <circle cx="10" cy="20" r="5" fill="#D6EBF7"/>
                            <circle cx="54" cy="20" r="5" fill="#D6EBF7"/>
                            <!-- Inner ear -->
                            <circle cx="10" cy="20" r="2.5" fill="#C5E2F5"/>
                            <circle cx="54" cy="20" r="2.5" fill="#C5E2F5"/>
                            <!-- Face highlight -->
                            <circle cx="32" cy="26" r="16" fill="white" opacity="0.4"/>
                            <!-- Sunglasses frame -->
                            <path d="M16 24 Q18 20 24 20 Q30 20 32 24 Q34 20 40 20 Q46 20 48 24" stroke="#1e3a5f" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <!-- Left lens -->
                            <ellipse cx="22" cy="24" rx="7" ry="5" fill="#1e3a5f"/>
                            <!-- Right lens -->
                            <ellipse cx="42" cy="24" rx="7" ry="5" fill="#1e3a5f"/>
                            <!-- Lens shine -->
                            <ellipse cx="19" cy="22" rx="2" ry="1.5" fill="#4a6b8a"/>
                            <ellipse cx="39" cy="22" rx="2" ry="1.5" fill="#4a6b8a"/>
                            <!-- Bridge -->
                            <path d="M29 24 Q32 26 35 24" stroke="#1e3a5f" stroke-width="2" fill="none"/>
                            <!-- Nose -->
                            <ellipse cx="32" cy="32" rx="3" ry="2.5" fill="#7CB3D8"/>
                            <!-- Smile -->
                            <path d="M26 38 Q32 44 38 38" stroke="#5A9BC7" stroke-width="2" fill="none" stroke-linecap="round"/>
                            <!-- Feet -->
                            <ellipse cx="24" cy="60" rx="6" ry="3" fill="#D6EBF7"/>
                            <ellipse cx="40" cy="60" rx="6" ry="3" fill="#D6EBF7"/>
                        </svg>
                        <span class="text-xl font-bold theme-text">Sherpa <span class="text-sherpa-blue dark:text-sherpa-teal">1099</span></span>
                    </a>
                    <div class="hidden md:flex ml-8 space-x-1">
                        <a href="/" class="px-4 py-2 rounded-xl text-sm font-medium transition-all {% if active_page == 'home' %}bg-sherpa-blue text-white shadow-sm{% else %}theme-muted theme-hover{% endif %}">
                            Home
                        </a>
                        <a href="/filers" class="px-4 py-2 rounded-xl text-sm font-medium transition-all {% if active_page == 'filers' or active_page == 'dashboard' %}bg-sherpa-blue text-white shadow-sm{% else %}theme-muted theme-hover{% endif %}">
                            Filers
                        </a>
                        <a href="/imports" class="px-4 py-2 rounded-xl text-sm font-medium transition-all {% if active_page == 'imports' %}bg-sherpa-blue text-white shadow-sm{% else %}theme-muted theme-hover{% endif %}">
                            Import
                        </a>
                        <a href="/download-template" class="px-4 py-2 rounded-xl text-sm font-medium transition-all theme-muted theme-hover">
                            Template
                        </a>
                    </div>
                </div>
                <div class="flex items-center gap-3">
                    <!-- Dark/Light Mode Toggle -->
                    <button @click="darkMode = !darkMode; localStorage.setItem('darkMode', darkMode)"
                            class="p-2 rounded-xl theme-hover transition-all"
                            :title="darkMode ? 'Switch to Light Mode' : 'Switch to Dark Mode'">
                        <!-- Sun icon (shown in dark mode) -->
                        <svg x-show="darkMode" class="w-5 h-5 text-sherpa-amber" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"/>
                        </svg>
                        <!-- Moon icon (shown in light mode) -->
                        <svg x-show="!darkMode" class="w-5 h-5 theme-muted" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"/>
                        </svg>
                    </button>

                    <span class="px-3 py-1.5 rounded-xl bg-sherpa-green text-white text-sm font-medium shadow-sm">
                        TY {{ operating_year.year if operating_year else '2025' }}
                    </span>
                    {% if user %}
                    <div class="flex items-center gap-2">
                        <span class="text-sm font-medium theme-text">{{ user.display_name }}</span>
                        <a href="/logout" class="px-3 py-1.5 rounded-xl text-sm theme-muted theme-hover transition-all">
                            Logout
                        </a>
                    </div>
                    {% else %}
                    <span class="px-2 py-1 rounded text-xs font-medium bg-sherpa-amber/15 text-sherpa-amber">DEV</span>
                    {% endif %}
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="flex-1 max-w-7xl w-full mx-auto py-6 px-4 sm:px-6 lg:px-8 relative z-10">
        {% block content %}{% endblock %}
    </main>

    <!-- Footer -->
    <footer class="glass-light mt-auto relative z-10">
        <div class="max-w-7xl mx-auto py-4 px-4 text-center text-sm theme-muted">
            Sherpa 1099 &copy; 2025 | IRS IRIS e-Filing
        </div>
    </footer>

    {% block extra_scripts %}{% endblock %}
</body>
</html>
